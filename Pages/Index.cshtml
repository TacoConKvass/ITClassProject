@page "/"
@model ITClassProject.Pages.IndexModel
@{
	ViewData["Title"] = "Main";
	Layout = "_Layout";

}

<link rel="stylesheet" type="text/css" href="/css/main.css" />

<main id="main-content">
	<div style="width:100%; display:inline-flex; flex-direction:column;">
		<form autocomplete="off" id="add-quote-form" method="post">
			<h3>Submit quote</h3>
			<div style="display:inline-flex; flex-direction:row;">
				<div class="quote-input">
					<textarea form="add-quote-form" name="source" placeholder="Source" maxlength="100" wrap="soft" class="source" rows="1" cols="100" required></textarea> <br>
					<textarea form="add-quote-form" name="quote" placeholder="Quote..." maxlength="400" wrap="soft" class="quote" rows="0" cols="100" required></textarea>
				</div>

				<div class="submit-quote">
					<input type="submit" value="Submit quote" />
				</div>
			</div>
			@Html.AntiForgeryToken()
		</form>
	</div>

	@{
		var quotesDbContext = ITClassProject.Database.Database.GetQuoteDbContext();
		var quotes = quotesDbContext.GetAllQuotes();
		quotes.Reverse();
		foreach (ITClassProject.Database.Models.Quote quote in quotes)
		{
			<div class="quote">
				<div class="quote-details">
					<text>Author: @quote.Author </text>
					<text> | </text>
					<text> Source: @quote.Source </text>
					@{
						if ((Model.currentUsername.ToString() == quote.Author && Model.currentUsername != "Guest") || Model.admin)
						{
							<text> | </text>
							<button onclick="onDelete(@quote.Id)">
								Delete
							</button>
						}
					}
				</div>

				<div class="quote-content">
					<text>
						@quote.Content
					</text>
				</div>
			</div>
		}
	}
</main>

<script>
	function onDelete(id) {
		var confirmed = confirm("Are you sure you want to delete this quote?")
		if (confirmed) {
			console.log(id)
			fetch(`/api/quote?id=${id}`, {
				method: 'DELETE'
			})
			// OMINIĘTE ŻEBY ERROR W KONSOLI BYŁO WIDAĆ
			//.then(() => {
			//	window.location.href = "../"
			//})
		}
	}
</script>